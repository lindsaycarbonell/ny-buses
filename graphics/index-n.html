<!DOCTYPE html>
<html lang="en-US" class="institute" xmlns:og="http://opengraphprotocol.org/schema/" itemscope itemtype="http://schema.org/CollectionPage" itemid="http://nyc17.nytimes-institute.com">
  <head>
    <title>Graphic! | The New York Times Student Journalism Institute </title>
    <meta charset="UTF-8" />
    <meta name="keywords" content="The New York Times, New York Times Student Journalism Institute, Student Journalism Institute, New York Times internship, New York Times students" />
    <meta itemprop="description" name="description" content="The New York Times Student Journalism Institute - New York City 2017" />
    <link rel="canonical" href="http://nyc17.nytimes-institute.com">
    <link rel="shortcut icon" href="http://nyc17.nytimes-institute.com/wp-content/themes/times-institute-minimal/favicon.ico" />
    <link rel='stylesheet' id='genericons-css'  href='http://nyc16.nytimes-institute.com/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1' type='text/css' media='all' />
    <link rel="pingback" href="http://nyc17.nytimes-institute.com/xmlrpc.php" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- twitter -->
    <meta name="twitter:site" content="nyt_institute" />
    <meta property="twitter:title" content="Graphic! | The New York Times Student Journalism Institute " />
    <meta property="twitter:description" content="The New York Times Student Journalism Institute - New York City 2017" />
    <meta name="twitter:image" content="http://nyc16.nytimes-institute.com/files/2016/05/NYTSJI_weblogo.png" />
    <!-- opengraph -->
    <meta property="og:title" content="Graphic! | The New York Times Student Journalism Institute " />
    <meta property="og:description" content="The New York Times Student Journalism Institute - New York City 2017" />
    <meta property="og:image" content="http://nyc16.nytimes-institute.com/files/2016/05/NYTSJI_weblogo.png" />
    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://nyc17.nytimes-institute.com/feed/" />
    <link rel='dns-prefetch' href='//s0.wp.com' />
    <link rel='dns-prefetch' href='//s.w.org' />
    <script type="text/javascript">
      window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/nyc17.nytimes-institute.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.5"}};
      !function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),!(j.toDataURL().length<3e3)&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,65039,8205,55356,57096),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57331,55356,57096),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55357,56425,55356,57341,8205,55357,56507),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55357,56425,55356,57341,55357,56507),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
    </script>
    <style type="text/css">
      img.wp-smiley,
      img.emoji {
        display: inline !important;
        border: none !important;
        box-shadow: none !important;
        height: 1em !important;
        width: 1em !important;
        margin: 0 .07em !important;
        vertical-align: -0.1em !important;
        background: none !important;
        padding: 0 !important;
      }
    </style>
    <link rel='stylesheet' id='nytsji-css'  href='http://nyc17.nytimes-institute.com/wp-content/themes/times-institute-minimal/style.css?ver=v002' type='text/css' media='all' />
    <!-- `sharedaddy` is included in the concatenated jetpack.css -->
    <link rel='stylesheet' id='social-logos-css'  href='http://nyc17.nytimes-institute.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=1' type='text/css' media='all' />
    <link rel='stylesheet' id='jetpack_css-css'  href='http://nyc17.nytimes-institute.com/wp-content/plugins/jetpack/css/jetpack.css?ver=4.9' type='text/css' media='all' />
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
    <link rel='https://api.w.org/' href='http://nyc17.nytimes-institute.com/wp-json/' />
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://nyc17.nytimes-institute.com/xmlrpc.php?rsd" />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://nyc17.nytimes-institute.com/wp-includes/wlwmanifest.xml" />
    <meta name="generator" content="WordPress 4.7.5" />
    <link rel="canonical" href="http://nyc17.nytimes-institute.com/graphic/" />
    <link rel='shortlink' href='http://wp.me/P8BaRf-1O' />
    <link rel="alternate" type="application/json+oembed" href="http://nyc17.nytimes-institute.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fnyc17.nytimes-institute.com%2Fgraphic%2F" />
    <link rel="alternate" type="text/xml+oembed" href="http://nyc17.nytimes-institute.com/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fnyc17.nytimes-institute.com%2Fgraphic%2F&#038;format=xml" />
    <link rel='dns-prefetch' href='//v0.wordpress.com'>
    <link rel='dns-prefetch' href='//i0.wp.com'>
    <link rel='dns-prefetch' href='//i1.wp.com'>
    <link rel='dns-prefetch' href='//i2.wp.com'>
    <link rel='dns-prefetch' href='//jetpack.wordpress.com'>
    <link rel='dns-prefetch' href='//s0.wp.com'>
    <link rel='dns-prefetch' href='//s1.wp.com'>
    <link rel='dns-prefetch' href='//s2.wp.com'>
    <link rel='dns-prefetch' href='//public-api.wordpress.com'>
    <link rel='dns-prefetch' href='//0.gravatar.com'>
    <link rel='dns-prefetch' href='//1.gravatar.com'>
    <link rel='dns-prefetch' href='//2.gravatar.com'>
    <meta name="title" content="Graphic! | New York City 2017 - The New York Times Student Journalism Institute" />
    <meta name="description" content="This is where our graphic will go." />
    <link rel="icon" href="https://i2.wp.com/nyc17.nytimes-institute.com/files/2017/04/cropped-cropped-nytsji_bug.png?fit=32%2C32" sizes="32x32" />
    <link rel="icon" href="https://i2.wp.com/nyc17.nytimes-institute.com/files/2017/04/cropped-cropped-nytsji_bug.png?fit=192%2C192" sizes="192x192" />
    <link rel="apple-touch-icon-precomposed" href="https://i2.wp.com/nyc17.nytimes-institute.com/files/2017/04/cropped-cropped-nytsji_bug.png?fit=180%2C180" />
    <meta name="msapplication-TileImage" content="https://i2.wp.com/nyc17.nytimes-institute.com/files/2017/04/cropped-cropped-nytsji_bug.png?fit=270%2C270" />
    <script type="text/javascript">
    /* <![CDATA[ */
      var wpNotesIsJetpackClient = true;
      var wpNotesIsJetpackClientV2 = true;
    /* ]]> */
    </script>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!-- CUSTOM STYLESHEETS -->
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"
    integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=="
    crossorigin=""/>
    <link href="css/main.css" rel="stylesheet" />



  </head>
  <body class="page-template-default page page-id-112 logged-in">
    <header id="top" class="container page-header">
      <h1 class="page-header-branding">
        <a href="http://nyc17.nytimes-institute.com/" title="New York City 2017 &#8211; The New York Times Student Journalism Institute" rel="home" id="logo">
          <img class="nytsji-logo" src="http://nyc17.nytimes-institute.com/wp-content/themes/times-institute-minimal/img/NYTSJI_weblogo.png">
          <img class="nytimes-logo" src="http://nyc17.nytimes-institute.com/wp-content/themes/times-institute-minimal/img/nytimes-logo.jpg">
          <div class="header-site-title">Student Journalism Institute</div>
        </a>
      </h1>
    </header>
    <section id="story" class="single-entry container">
      <article id="post-112" class="entry post-112 page type-page status-publish hentry" itemscope itemid="http://nyc17.nytimes-institute.com/graphic/" itemtype="http://schema.org/NewsArticle">
        <header class="entry-header">
          <h2 class="entry-title" itemprop="headline name">
            <a href="http://nyc17.nytimes-institute.com/graphic/" rel="bookmark" itemprop="url">Graphic!</a>
          </h2>
        </header><!-- .entry-header -->
        <section class="entry-meta">
          <span class="byline" itemscope itemtype="http://schema.org/Person">
            <span class="by">By </span><a href="http://nyc17.nytimes-institute.com/author/lindsay-carbonell/" title="Posts by Lindsay Carbonell" class="author url fn" rel="author" itemprop="author name url">Lindsay Carbonell</a> and <a href="http://nyc17.nytimes-institute.com/author/felipe-de-la-hoz/" title="Posts by Felipe De La Hoz" class="author url fn" rel="author" itemprop="author name url">Felipe De La Hoz</a>
          </span>
          <a class="date" href="http://nyc17.nytimes-institute.com/graphic/" rel="bookmark">
            <time class="dt-published published entry-date rel_time" itemprop="datePublished" datetime="2017-05-26T12:29:46+00:00">May 26, 2017</time>
          </a>
        </section><!-- .entry-meta -->
        <div class="entry-content" itemprop="articleBody text">
          <div id="graphic">HERE.  This is where our graphic could go.</div>
          <div id="mapid"></div>

          <!-- CUSTOM SCRIPTS -->
            <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
          <script src="https://d3js.org/d3.v4.min.js"></script>
          <script src="http://cdn.rawgit.com/gka/d3-jetpack/master/build/d3-jetpack.js" charset="utf-8"></script>
          <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"
          integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=="
          crossorigin="" type="text/javascript"></script>

          <style>
            #graphic {
              display: block;
              margin: 20px 0px;
              outline: 1px dotted lime;
              /*max-width: 970px; ...or full-bleed, but for now let's stay conservative*/
            }
          </style>
          <!-- sharetools -->
          <div class="sharedaddy sd-sharing-enabled">
            <div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing"><div class="sd-content"><ul><li class="share-facebook"><a rel="nofollow" data-shared="sharing-facebook-112" class="share-facebook sd-button share-icon no-text" href="http://nyc17.nytimes-institute.com/graphic/?share=facebook" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li><li class="share-twitter"><a rel="nofollow" data-shared="sharing-twitter-112" class="share-twitter sd-button share-icon no-text" href="http://nyc17.nytimes-institute.com/graphic/?share=twitter" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li><li class="share-email"><a rel="nofollow" data-shared="" class="share-email sd-button share-icon no-text" href="http://nyc17.nytimes-institute.com/graphic/?share=email" target="_blank" title="Click to email this to a friend"><span></span><span class="sharing-screen-reader-text">Click to email this to a friend (Opens in new window)</span></a></li><li class="share-end"></li></ul></div></div>
          </div>
        </div>
      </article>
    </section>
    <footer id="bottom" class="container">
      <section class="column">
        <div id="feed">
          <h4 class="subhead">More Stories</h4>
          <article id="excerpt-17" class="summary post-17 post type-post status-publish format-standard has-post-thumbnail hentry category-more" itemscope itemid="#" itemtype="http://schema.org/NewsArticle">
            <header class="summary-header">
              <h3 class="summary-title" itemprop="headline name">
                <a href="#" rel="bookmark" itemprop="url">Recent Post #1</a>
              </h3>
            </header>
            <section class="summary-meta">
              <span class="byline" itemscope itemtype="http://schema.org/Person">
                <span class="by">By </span><a href="#" title="Posts by Reporter" class="author url fn" rel="author" itemprop="author name url">Byline</a>
              </span>
              <a class="date" href="#" rel="bookmark"><time class="dt-published published entry-date rel_time" itemprop="datePublished" datetime="2017-04-14T17:24:04+00:00">April 14, 2017</time></a>
            </section>
          </article>
          <article id="excerpt-96" class="summary post-96 post type-post status-publish format-standard hentry category-uncategorized" itemscope itemid="#" itemtype="http://schema.org/NewsArticle">
            <header class="summary-header">
              <h3 class="summary-title" itemprop="headline name">
                <a href="#" rel="bookmark" itemprop="url">Recent Post #2</a>
              </h3>
            </header>
            <section class="summary-meta">
              <span class="byline" itemscope itemtype="http://schema.org/Person">
                <span class="by">By </span><a href="#" title="Posts by Reporter" class="author url fn" rel="author" itemprop="author name url">Byline</a>
              </span>
              <a class="date" href="#" rel="bookmark"><time class="dt-published published entry-date rel_time" itemprop="datePublished" datetime="2017-05-25T15:41:19+00:00">May 25, 2017</time></a>
            </section>
          </article>
          <article id="excerpt-27" class="summary post-27 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized" itemscope itemid="#" itemtype="http://schema.org/NewsArticle">
            <header class="summary-header">
              <h3 class="summary-title" itemprop="headline name">
                <a href="#" rel="bookmark" itemprop="url">Recent Post #3</a>
              </h3>
            </header>
            <section class="summary-meta">
              <span class="byline" itemscope itemtype="http://schema.org/Person">
                <span class="by">By </span><a href="#" title="Posts by Reporter" class="author url fn" rel="author" itemprop="author name url">Byline</a>
              </span>
              <a class="date" href="#" rel="bookmark"><time class="dt-published published entry-date rel_time" itemprop="datePublished" datetime="2017-05-08T13:37:18+00:00">May 8, 2017</time></a>
            </section>
          </article>
          <h4 class="subhead" id="search-headline">Search</h4>
          <div id="search">
            <form role="search" method="get" id="searchform" class="searchform" action="http://nyc17.nytimes-institute.com/">
              <div>
                <label class="screen-reader-text" for="s">Search for:</label>
                <input type="text" value="" name="s" id="s" />
                <input type="submit" id="searchsubmit" value="Search" />
              </div>
            </form>
          </div>
        </div>
        <div id="about">
          <h4 class="subhead">Connect With Us</h4>
          <ul id="social">
            <li class="social" id="facebook"><a href="https://www.facebook.com/nyt.institute/" target="facebook">Like Us on Facebook</a></li>
            <li class="social" id="twitter"><a href="https://twitter.com/nyt_institute/" target="twitter">Follow Us on Twitter</a></li>
            <li class="social" id="pinterest"><a href="https://www.pinterest.com/nytinstitute/" target="pinterest">Follow Us on Pinterest</a></li>
            <li class="social" id="instagram"><a href="https://www.instagram.com/nytinstitute/" target="instagram">See our photos on Instagram</a></li>
          </ul>
          <h4 class="subhead">About Us</h4>
          <p>
            The New York Times Student Journalism Institute is run by
            <a href="http://www.nytimes.com/" target="times">The New York Times</a> in partnership with
            <a href="http://www.nahj.org/" target="org"><abbr title="National Association of Hispanic Journalists">NAHJ</abbr></a>,
            <a href="http://www.nabj.org/" target="org"><abbr title="National Association of Black Journalists">NABJ</abbr></a> and
            <a href="http://www.journalism.cuny.edu/" target="cuny"><abbr title="City University New York">CUNY</abbr> Graduate School of Journalism.
          </p>
          <div id="institute">
            <a href="http://nytimes-institute.com/about-the-institute/" target="learn">Learn More</a>
            &nbsp;|&nbsp;
            <a href="http://www.nytco.com/careers/Student-Journalism-Institute/" target="apply">Apply</a>
          </div>
        </div>
      </section>
      <section id="legal">
        <p>
          New York City 2017 &#8211; The New York Times Student Journalism Institute <span class="copyright">&#169;</span> copyright 2017        </p>
      </section>
    </footer>
    <script type="text/javascript">
      window.WPCOM_sharing_counts = {"http:\/\/nyc17.nytimes-institute.com\/graphic\/":112};
    </script>
    <link rel='stylesheet' id='wpcom-notes-admin-bar-css'  href='http://s0.wp.com/wp-content/mu-plugins/notes/admin-bar-v2.css?ver=4.9-201721' type='text/css' media='all' />
    <link rel='stylesheet' id='noticons-css'  href='http://s0.wp.com/i/noticons/noticons.css?ver=4.9-201721' type='text/css' media='all' />
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-content/plugins/jetpack/modules/photon/photon.js?ver=20130122'></script>
    <script type='text/javascript' src='https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201721'></script>
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-includes/js/underscore.min.js?ver=1.8.3'></script>
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-content/themes/times-institute-minimal/js/custom.js?ver=v002'></script>
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-includes/js/wp-embed.min.js?ver=4.7.5'></script>
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-includes/js/backbone.min.js?ver=1.2.3'></script>
    <script type='text/javascript' src='http://s1.wp.com/wp-content/js/mustache.js?ver=4.9-201721'></script>
    <script type='text/javascript' src='http://s1.wp.com/wp-content/mu-plugins/notes/notes-common-v2.js?ver=4.9-201721'></script>
    <script type='text/javascript' src='http://s0.wp.com/wp-content/mu-plugins/notes/admin-bar-v2.js?ver=4.9-201721'></script>
    <script type='text/javascript'>
    /* <![CDATA[ */
    var sharing_js_options = {"lang":"en","counts":"1"};
    /* ]]> */
    </script>
    <script type='text/javascript' src='http://nyc17.nytimes-institute.com/wp-content/plugins/jetpack/modules/sharedaddy/sharing.js?ver=4.9'></script>
    <script type='text/javascript'>
      var windowOpen;
      jQuery( document.body ).on( 'click', 'a.share-facebook', function() {
        // If there's another sharing window open, close it.
        if ( 'undefined' !== typeof windowOpen ) {
          windowOpen.close();
        }
        windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
        return false;
      });
      var windowOpen;
      jQuery( document.body ).on( 'click', 'a.share-twitter', function() {
        // If there's another sharing window open, close it.
        if ( 'undefined' !== typeof windowOpen ) {
          windowOpen.close();
        }
        windowOpen = window.open( jQuery( this ).attr( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
        return false;
      });
    </script>
    <!-- <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
    <script>
      console.log('d3 has loaded via a `custom_frontend` special parameter defined on the Page via WordPress -- we could include custom scripts this way');

      //lindsay's code below
      $(document).ready(function(){

      console.log('ready');

      d3.csv('assets/school_delays.csv', initMap);

      function initMap(data){


        var mymap = L.map('mapid', {
          center: [40.81432890763712,-73.9500904083252],
          zoom: 13,
          dragging: false,
          zoomControl: false,
          scrollWheelZoom: false
        });

        // mymap = L.map('mapid').setView([40.83641142008943,-73.92631530761719], 12);



        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/light-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibGluZHNheWNhcmJvbmVsbCIsImEiOiJjaXRlajNhd2cwNjBkMzJvOW04OWQ0dm5xIn0.GGAg70cv_JpPUXxFvkdY-w').addTo(mymap);

        data.forEach(function(d){

          // debugger
          // d.total_delay/5
          // d.median_delay*10
          // d.num_of_incidents*5

          if (parseInt(d.num_of_incidents) >= 10){
            var thisCircle = L.circle([parseFloat(d.Latitude), parseFloat(d.Longitude)], {
              color: 'red',
              fillColor: 'transparent',
              radius: 3,
              className: 'mapCircle ' + d.Name
            });
            thisCircle.addTo(mymap);

            if(d.Name.includes("Opportunity")){
              thisCircle.setStyle({color:'blue', radius: 4, weight:5});
              thisCircle.bindTooltip(d.Name, {permanent: true, className: "schoolLabel", offset: [-8, 10] });
              thisCircle._id = "1";
            }

          }

          mymap.eachLayer(function(L){
            //debugger
            if (L._id === "1"){
              L.bringToFront();
            }
          })


        })






          //create markers
          // lats.push(d.Latitude);
          // longs.push(d.Longitude);

          // var thisMarker = L.marker([d.Latitude, d.Longitude]);
          //
          // thisMarker.addTo(mymap);


      }


      d3.csv('assets/all.csv', initChart);

      function initChart(data){





        data.forEach(function(d) {




          d.How_Long_Delayed = parseInt(d.How_Long_Delayed)
        })


        data = data.filter(function(d) {
          return ! isNaN(d.How_Long_Delayed)
        })

        const max_delay = d3.max(data, function(d){
          return parseInt(d.How_Long_Delayed);
        })

        const nested = d3.nest()
          .key(function(d){
            return d.Name;
          })
          .entries(data)
          .slice(0,40);

        nested.sort(function(a, b){
          const a_total = d3.sum(a.values, function(d){
            return d.How_Long_Delayed;
          })
          const b_total = d3.sum(b.values, function(d){
            return d.How_Long_Delayed;
          })
          return d3.descending(a_total, b_total);
        })

        const school_names = nested.map(function(d){
          return d.key;
        })

          // debugger
        const height = 500;
        const width = 1000;
        const max_minutes = 800;
        const yScale = d3.scaleBand()
                        .domain(school_names)
                        .range([0,height]);
        const xScale = d3.scaleLinear()
                        .domain([0, max_minutes])
                        .range([0, width]);
        const opacityColorScale = d3.scaleThreshold()
                          .domain([20, 40, 60])
                          .range([0.2, 0.5, 0.8, 1.0])
        // const standardColorScale = d3.scaleLinear()
        //                   .domain([0, max_delay])
        //                   .range(['#fff', '#551A8B'])



        const conventions = d3.conventions({
          y: yScale,
          x: xScale,
          width: width,
          height: height,
          margin: {left: 200}
        });

        //var width = d3.select('svg').node().offsetWidth

        conventions.drawAxis();

        const schools = conventions.svg.appendMany(nested, 'g.school');


        schools.translate(function(d){
          const y = yScale(d.key);
          return [0,y];

        });


        schools.each(function(d){
          var total_width = 0;

          const filtered = d.values.filter(function(d){
            const parsed = parseInt(d.How_Long_Delayed);
            if (!isNaN(parsed)){
              return true;
            } else {
              return false;
            }

          })

          filtered.sort(function(a, b){
            return d3.descending(a.How_Long_Delayed, b.How_Long_Delayed);
          })

          d3.select(this).appendMany(filtered, 'rect.delay')
          //draw the rects
            .attr('width', function(d){
              const width = xScale(parseInt(d.How_Long_Delayed));
              // console.log(width);
              return width;
            })
            .attr('height', yScale.bandwidth())
            // .style('fill', function(d){
            //   return delayColors(parseInt(d.How_Long_Delayed));
            // })
            .style('opacity', function(d){
              return opacityColorScale(parseInt(d.How_Long_Delayed));
            })
          //separate the rects
            .translate(function(d){
              const current_width = total_width;
              //total_width += xScale(parseInt(d.How_Long_Delayed))
              total_width += parseInt(d3.select(this).attr('width')) +1;
              // console.log(current_width);
              return [current_width, 0];

            })
        });

      }; //init


      }); //doc ready


    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      //create our tracker, named INT, with its own cookie
      ga('create', 'UA-28207678-1', {'alwaysSendReferrer':true, 'cookieName':'ga_INT', 'name':'INT'});
      //cleanup null referrers
      var clean_ref = (typeof document.referrer !== 'undefined' && document.referrer !== "" && document.referrer.indexOf('tucson15.') < 0) ? document.referrer : null;
      ga('INT.set', 'referrer', clean_ref);
      //preface any GA method calls with INT.
      ga('INT.send','pageview', {location: window.location.href, page: window.location.pathname, title: document.title});
    </script>
  </body>
</html>
